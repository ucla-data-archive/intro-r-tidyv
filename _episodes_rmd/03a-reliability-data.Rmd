---
title: "03a-reliability-data.Rmd"
author: "Tim Dennis"
date: "1/26/2019"
output: html_document
---

```{r setup, include=FALSE}
# Install ggplot and ggmap (this is only required once)
#install.packages('ggplot2', dependencies = TRUE)
#install.packages('ggmap', dependencies = TRUE)
```

```{r packages}
# load packages
library(ggplot2)
library(ggmap)
library(readr)
library(dplyr)
library(stringr)
```

## R Markdown



```{r}
#read in MBTA performance csv file
rawdata <- read_csv("data/TDashboardData_reliability_20160301-20160331.csv")
View(rawdata)
```
1. Take rawdata and pipe through filter
1. Filter by peak service (weekday rush hour)
1. Filter by only the green line
1. Mutate to create or overwrite a variable 
1. str_trim to remove whitespaces before and after values
1. Create a rely varialbe that 
1. Finds the reliability at each station
1. Divides the numerator (people who have to wait too long) by the denominator (all riders).
1. This is the percentage of people who had to wait. 1 - this ratio is the percentage of people who didn't.
1. drop the columns we don't need for futher analysis

```{r}
rawdata %>% 
  filter(PEAK_OFFPEAK_IND == "Peak Service (Weekdays 6:30-9:30AM, 3:30PM-6:30PM)", ROUTE_TYPE=="Green Line" ) %>% 
    mutate(STOP = str_trim(STOP), rely = 1 - OTP_NUMERATOR/OTP_DENOMINATOR, rely = round(rely, 4)) %>% 
   select(-c("SERVICE_DATE","ROUTE_TYPE"))
```



## Adding Geolocation data to the dataframe via another table

* The lat/long data is in mbta_stations.csv 
* Import the MBTA station location data

stations <- read_csv("transit-data-toolkit 2/mbta_stations.csv")

* We will set up our dplyr sequence taking `stations` and passing it thru funcitons
* Select only the Green Line data

```{r}
stations %>% 
  

```


locs <- stations[which (stations$LINE=='GREEN'),]

# Change the name of Station to Stop to match the other dataframe
colnames(locs)[2] <- "STOP" 
View(locs)


# Join the location data to the reliability file
joindata <- merge(x = reliability, y = locs, by ="STOP", all.x=TRUE)

#Select only the columns need
joindata <- joindata[c("STOP","SERVICE_DATE","ROUTE_TYPE","rely","LONGITUDE","LATITUDE")]
x = !duplicated(joindata$STOP)
joindata <- joindata[x ,]
View(joindata)

